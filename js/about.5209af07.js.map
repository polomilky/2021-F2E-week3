{"version":3,"sources":["webpack:///./src/views/About.vue?4dc2","webpack:///./src/views/About.vue?334a","webpack:///src/views/About.vue","webpack:///./src/views/About.vue?55f7","webpack:///./src/views/About.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","areaData","on","getSelectArea","model","value","callback","$$v","selectArea","expression","routeName","getSearchData","_v","_l","aliveGoBusData","idx","key","_s","stopName","stopStatus","estimatedSeconds","_e","Math","floor","staticRenderFns","aliveBackBusData","component","VBtn","VContainer","VSelect","VTextField"],"mappings":"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","file":"js/about.5209af07.js","sourcesContent":["export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--10-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./About.vue?vue&type=style&index=0&id=7afd5816&lang=sass&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-container',[_c('div',{staticClass:\"about\"},[_c('v-select',{attrs:{\"items\":_vm.areaData,\"item-text\":\"CityName\",\"item-value\":\"City\",\"label\":\"選擇縣市\",\"dense\":\"\",\"outlined\":\"\",\"hide-details\":\"auto\",\"return-object\":\"\"},on:{\"change\":_vm.getSelectArea},model:{value:(_vm.selectArea),callback:function ($$v) {_vm.selectArea=$$v},expression:\"selectArea\"}}),_c('hr'),_c('v-text-field',{attrs:{\"label\":\"輸入公車路線\",\"outlined\":\"\",\"solo\":\"\",\"dense\":\"\",\"hide-details\":\"auto\",\"append-icon\":\"mdi-magnify\"},model:{value:(_vm.routeName),callback:function ($$v) {_vm.routeName=$$v},expression:\"routeName\"}}),_c('v-btn',{on:{\"click\":_vm.getSearchData}},[_vm._v(\"送出\")]),_c('div',_vm._l((_vm.aliveGoBusData),function(aliveGoBusData,idx){return _c('div',{key:idx},[_c('span',[_vm._v(_vm._s(aliveGoBusData.stopName))]),(aliveGoBusData.stopStatus === 0 && aliveGoBusData.estimatedSeconds < 120)?_c('span',[_vm._v(\"進站中\"+_vm._s(aliveGoBusData.estimatedSeconds)+\"秒\")]):_vm._e(),(aliveGoBusData.stopStatus === 0 && aliveGoBusData.estimatedSeconds > 120)?_c('span',[_vm._v(\"約\"+_vm._s(Math.floor(aliveGoBusData.estimatedSeconds/60))+\"分\")]):_vm._e(),(aliveGoBusData.stopStatus !== 0)?_c('span',[_vm._v(\" \"+_vm._s((aliveGoBusData.stopStatus === 1) ? '尚未發車' : (aliveGoBusData.stopStatus === 2) ? '交管不停靠' : (aliveGoBusData.stopStatus === 3) ? '末班車已過' : '今日未營運')+\" \")]):_vm._e()])}),0),_c('hr')],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <v-container>\n    <div class=\"about\">\n      <v-select\n        :items=\"areaData\"\n        v-model=\"selectArea\"\n        item-text=\"CityName\"\n        item-value=\"City\"\n        label=\"選擇縣市\"\n        dense\n        outlined\n        hide-details=\"auto\"\n        return-object\n        @change=\"getSelectArea\"\n      ></v-select>\n      <hr />\n      <v-text-field\n        label=\"輸入公車路線\"\n        v-model=\"routeName\"\n        outlined\n        solo\n        dense\n        hide-details=\"auto\"\n        append-icon=\"mdi-magnify\"\n      ></v-text-field>\n      <v-btn @click=\"getSearchData\">送出</v-btn>\n      <div>\n        <!-- {{aliveGoBusData}} -->\n        <div v-for=\"(aliveGoBusData, idx) in aliveGoBusData\" :key=\"idx\">\n          <span>{{aliveGoBusData.stopName}}</span>\n          <!-- 車輛狀態備註 : [0:'正常',1:'尚未發車',2:'交管不停靠',3:'末班車已過',4:'今日未營運'] ,  -->\n          <span v-if=\"aliveGoBusData.stopStatus === 0 && aliveGoBusData.estimatedSeconds < 120\">進站中{{aliveGoBusData.estimatedSeconds}}秒</span>\n          <span v-if=\"aliveGoBusData.stopStatus === 0 && aliveGoBusData.estimatedSeconds > 120\">約{{Math.floor(aliveGoBusData.estimatedSeconds/60)}}分</span>\n          <span v-if=\"aliveGoBusData.stopStatus !== 0\">\n            {{(aliveGoBusData.stopStatus === 1) ? '尚未發車' : (aliveGoBusData.stopStatus === 2) ? '交管不停靠' : (aliveGoBusData.stopStatus === 3) ? '末班車已過' : '今日未營運'}}\n          </span>\n        </div>\n      </div>\n      <hr />\n      <!-- <div>\n        {{aliveBackBusData}}\n      </div> -->\n    </div>\n  </v-container>\n</template>\n\n<script>\n  import jsSHA from \"jssha\"\n\n  export default {\n    name: 'About',\n    props: [],\n    components: {\n    },\n\n    data: () => ({\n      // 選擇縣市\n      selectArea: null,\n      areaData: [],\n      // 公車路線\n      routeName: null,\n      // 篩選出有在跑的公車(去程/回程)\n      aliveGoBusData: [],\n      aliveBackBusData: [],\n    }),\n    computed: {\n    },\n    methods: {\n      getAuthorizationHeader() {\n          //  填入自己 ID、KEY 開始\n          let AppID = process.env.VUE_APP_API_ID;\n          let AppKey = process.env.VUE_APP_API_KEY;\n          //  填入自己 ID、KEY 結束\n          let GMTString = new Date().toGMTString();\n          let ShaObj = new jsSHA('SHA-1', 'TEXT');\n          ShaObj.setHMACKey(AppKey, 'TEXT');\n          ShaObj.update('x-date: ' + GMTString);\n          let HMAC = ShaObj.getHMAC('B64');\n          let Authorization = `hmac username=\"${AppID}\",algorithm=\"hmac-sha1\",headers=\"x-date\",signature=\"${HMAC}\"`\n          return { 'Authorization': Authorization, 'X-Date': GMTString };\n      },\n      // 取得縣市api\n      getAreaData() {\n        this.axios.get(\n          `https://gist.motc.gov.tw/gist_api/V3/Map/Basic/City?$format=JSON`, {\n            headers: this.getAuthorizationHeader()\n          }\n        )\n          .then((response) => {\n            this.areaData = response.data;\n          })\n          .catch((error) => {\n            console.log(error);\n          });\n      },\n      // 選擇縣市\n      getSelectArea(e) {\n        this.selectArea = e.City;\n      },\n      // 取得搜尋資料\n      async getSearchData() {\n        try {\n          const [{ value: estimatedTimes }, { value: stops }] =\n          await Promise.allSettled([\n            this.getEstimatedTimeData(),\n            this.getStopOfRoute()\n          ]);\n          console.log(estimatedTimes);\n          console.log(stops);\n          this.aliveGoBusData = this.getStopsStatus(0, stops, estimatedTimes) ?? []; //沒有去程\n          this.aliveBackBusData = this.getStopsStatus(1, stops, estimatedTimes) ?? []; //沒有返程\n        } catch (err) {\n          alert(`錯誤: ${err}`)\n        }\n      },\n      // 取得公車到站時間與發車狀態\n      getEstimatedTimeData() {\n        return new Promise((resolve, reject) => {\n          this.axios.get(\n            `https://ptx.transportdata.tw/MOTC/v2/Bus/EstimatedTimeOfArrival/City/${this.selectArea}/${this.routeName}?$format=JSON`, {\n              headers: this.getAuthorizationHeader()\n            }\n          )\n          .then((response) => {\n            resolve(response.data);\n          })\n          .catch((error) => {\n            reject(error);\n          });\n        });\n      },\n      // 取得各站點\n      getStopOfRoute() {\n        return new Promise((resolve, reject) => {\n          this.axios.get(\n            `https://ptx.transportdata.tw/MOTC/v2/Bus/StopOfRoute/City/${this.selectArea}/${this.routeName}?$format=JSON`, {\n              headers: this.getAuthorizationHeader()\n            }\n          )\n          .then((response) => {\n            resolve(response.data);\n          })\n          .catch((error) => {\n            reject(error);\n          });\n        })\n      },\n      // \n      getStopsStatus(direction, stops, estimatedTimes) {\n        return stops\n          .find(({ Direction }) => Direction === direction)\n          ?.Stops.map((stop) => {\n            const { PlateNumb, EstimateTime, StopStatus } =\n              estimatedTimes.find(\n                ({ Direction, StopUID }) =>\n                  Direction === direction && StopUID === stop.StopUID\n              ) ?? {};\n            return {\n              stopUID: stop.StopUID,\n              stopName: stop.StopName.Zh_tw,\n              stopStatus: StopStatus,\n              plateNumb: PlateNumb,\n              estimatedSeconds: EstimateTime,\n            };\n          })\n          .filter(\n            (stop, index, originalArray) =>\n              index ===\n              originalArray.findIndex(\n                (stopDuplicate) => stop.stopUID === stopDuplicate.stopUID\n            )\n          );\n      }\n    },\n    mounted() {\n      this.getAreaData();\n    },\n    watch: {\n    }\n  }\n</script>\n\n<style lang=\"sass\" scoped>\n  // $primary-colors-Y: #F1A923\n  // $primary-colors-R: #D9661F\n  // $primary-colors-W: #FCECD0\n  // $primary-colors-G: #9FB07A\n  // $primary-colors-B: #528370\n  // $primary-text: 'Noto Sans TC'\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./About.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./About.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./About.vue?vue&type=template&id=7afd5816&scoped=true&\"\nimport script from \"./About.vue?vue&type=script&lang=js&\"\nexport * from \"./About.vue?vue&type=script&lang=js&\"\nimport style0 from \"./About.vue?vue&type=style&index=0&id=7afd5816&lang=sass&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"7afd5816\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\nimport { VSelect } from 'vuetify/lib/components/VSelect';\nimport { VTextField } from 'vuetify/lib/components/VTextField';\ninstallComponents(component, {VBtn,VContainer,VSelect,VTextField})\n"],"sourceRoot":""}